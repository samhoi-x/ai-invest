"""Internationalization (i18n) support for the dashboard."""

import streamlit as st

TRANSLATIONS = {
    "en": {
        "app_title": "AI Smart Invest",
        "app_subtitle": "Intelligent Investment Analysis System",
        "market_overview": "Market Overview",
        "market_snapshot": "Market Snapshot",
        "price_chart": "Price Chart",
        "asset_type": "Asset Type",
        "stock": "Stock",
        "crypto": "Crypto",
        "period": "Period",
        "watchlist": "Watchlist",
        "correlation_heatmap": "Correlation Heatmap (Stock Watchlist)",
        "ai_signals": "AI Trading Signals",
        "disclaimer": "Signals are for educational/reference purposes only. Not investment advice.",
        "select_symbol": "Select Symbol",
        "generate_signal": "Generate Signal",
        "analyzing": "Analyzing",
        "factor_breakdown": "Factor Breakdown",
        "tech_details": "Technical Analysis Details",
        "sent_details": "Sentiment Analysis Details",
        "ml_details": "ML Model Details",
        "price_chart_indicators": "Price Chart with Indicators",
        "recent_signals": "Recent Signals",
        "no_signals": "No signals generated yet. Click 'Generate Signal' above.",
        "portfolio": "Portfolio Management",
        "add_holding": "Add/Update Holding",
        "portfolio_summary": "Portfolio Summary",
        "total_value": "Total Value",
        "total_cost": "Total Cost",
        "unrealized_pnl": "Unrealized P&L",
        "positions": "Positions",
        "current_allocation": "Current Allocation",
        "holdings_detail": "Holdings Detail",
        "remove_holding": "Remove Holding",
        "portfolio_optimization": "Portfolio Optimization",
        "run_optimization": "Run Optimization",
        "rebalance_suggestions": "Rebalance Suggestions",
        "transaction_history": "Transaction History",
        "risk_monitor": "Risk Monitor",
        "risk_overview": "Risk Overview",
        "drawdown_protection": "Drawdown Protection",
        "position_risk": "Position Risk Analysis",
        "risk_limit_status": "Risk Limit Status",
        "risk_alerts": "Risk Alert Log",
        "backtest": "Strategy Backtest",
        "backtest_params": "Backtest Parameters",
        "run_backtest": "Run Backtest",
        "performance_summary": "Performance Summary",
        "equity_curve": "Equity Curve",
        "trade_log": "Trade Log",
        "prev_backtests": "Previous Backtests",
        "performance": "Performance Tracking",
        "signal_accuracy": "Signal Accuracy Statistics",
        "confidence_dist": "Signal Confidence Distribution",
        "signal_strength_time": "Signal Strength Over Time",
        "factor_contribution": "Factor Contribution Breakdown",
        "backtest_comparison": "Backtest Performance Comparison",
        "transaction_summary": "Transaction Summary",
        "settings": "System Settings",
        "api_keys": "API Keys",
        "notifications": "Notifications",
        "signal_weights": "Signal Weights",
        "risk_parameters": "Risk Parameters",
        "data_management": "Data Management",
        "scheduler": "Auto Scheduler",
        "language": "Language",
        "loading": "Loading",
        "no_data": "No data available",
        "computing": "Computing",
        "fetching": "Fetching market prices...",
        "signal_summary": "Signal Summary",
        "why_this_signal": "Why this signal?",
        "action_plan": "Action Plan",
        "shares_to_buy": "Shares to Buy",
        "entry_price": "Entry Price",
        "stop_loss_price": "Stop-Loss Price",
        "position_size": "Position Size",
        "dollar_risk": "Dollar Risk",
        "target_price": "Target Price",
        "risk_reward": "Risk/Reward Ratio",
        "trade_blocked": "Trade Blocked",
        "of_portfolio": "of portfolio",
        "below_entry": "below entry",
        "factors_agree": "All factors agree on direction — higher reliability",
        "factors_disagree": "Factors disagree — confidence reduced",
        "tip_rsi": "RSI measures if a stock is overbought or oversold. Below 30 = oversold (potential buy), above 70 = overbought (potential sell).",
        "tip_macd": "MACD tracks momentum. When MACD crosses above the signal line, it suggests bullish momentum.",
        "tip_bollinger": "Bollinger Bands show volatility. Price near the lower band may indicate undervaluation.",
        "tip_sentiment": "Sentiment Analysis scans news and social media to gauge market mood — optimistic (bullish) or pessimistic (bearish).",
        "tip_ml": "Machine Learning models (XGBoost, LightGBM, LSTM) use historical patterns to predict 5-day price direction.",
        "tip_technical": "Technical Analysis examines price patterns and indicators to predict future movements based on historical data.",
    },
    "zh": {
        "app_title": "AI \u667a\u80fd\u6295\u8cc7",
        "app_subtitle": "\u667a\u80fd\u6295\u8cc7\u5206\u6790\u7cfb\u7d71",
        "market_overview": "\u5e02\u5834\u7e3d\u89bd",
        "market_snapshot": "\u5e02\u5834\u5feb\u7167",
        "price_chart": "\u50f9\u683c\u5716\u8868",
        "asset_type": "\u8cc7\u7522\u985e\u578b",
        "stock": "\u80a1\u7968",
        "crypto": "\u52a0\u5bc6\u8ca8\u5e63",
        "period": "\u6642\u9593\u7bc4\u570d",
        "watchlist": "\u81ea\u9078\u6e05\u55ae",
        "correlation_heatmap": "\u76f8\u95dc\u6027\u71b1\u529b\u5716\uff08\u80a1\u7968\u81ea\u9078\uff09",
        "ai_signals": "AI \u4ea4\u6613\u4fe1\u865f",
        "disclaimer": "\u4fe1\u865f\u50c5\u4f9b\u5b78\u7fd2/\u53c3\u8003\u7528\u9014\uff0c\u975e\u6295\u8cc7\u5efa\u8b70\u3002",
        "select_symbol": "\u9078\u64c7\u6a19\u7684",
        "generate_signal": "\u7522\u751f\u4fe1\u865f",
        "analyzing": "\u5206\u6790\u4e2d",
        "factor_breakdown": "\u56e0\u5b50\u5206\u89e3",
        "tech_details": "\u6280\u8853\u5206\u6790\u8a73\u60c5",
        "sent_details": "\u60c5\u7dd2\u5206\u6790\u8a73\u60c5",
        "ml_details": "ML \u6a21\u578b\u8a73\u60c5",
        "price_chart_indicators": "\u50f9\u683c\u5716\u8868\u8207\u6307\u6a19",
        "recent_signals": "\u6700\u8fd1\u4fe1\u865f",
        "no_signals": "\u5c1a\u672a\u7522\u751f\u4fe1\u865f\uff0c\u8acb\u9ede\u64ca\u4e0a\u65b9\u300c\u7522\u751f\u4fe1\u865f\u300d\u3002",
        "portfolio": "\u6295\u8cc7\u7d44\u5408\u7ba1\u7406",
        "add_holding": "\u65b0\u589e/\u66f4\u65b0\u6301\u5009",
        "portfolio_summary": "\u6295\u8cc7\u7d44\u5408\u6458\u8981",
        "total_value": "\u7e3d\u5e02\u503c",
        "total_cost": "\u7e3d\u6210\u672c",
        "unrealized_pnl": "\u672a\u5be6\u73fe\u640d\u76ca",
        "positions": "\u6301\u5009\u6578",
        "current_allocation": "\u7576\u524d\u914d\u7f6e",
        "holdings_detail": "\u6301\u5009\u660e\u7d30",
        "remove_holding": "\u79fb\u9664\u6301\u5009",
        "portfolio_optimization": "\u6295\u8cc7\u7d44\u5408\u512a\u5316",
        "run_optimization": "\u57f7\u884c\u512a\u5316",
        "rebalance_suggestions": "\u518d\u5e73\u8861\u5efa\u8b70",
        "transaction_history": "\u4ea4\u6613\u7d00\u9304",
        "risk_monitor": "\u98a8\u63a7\u76e3\u63a7",
        "risk_overview": "\u98a8\u96aa\u7e3d\u89bd",
        "drawdown_protection": "\u56de\u64a4\u4fdd\u8b77",
        "position_risk": "\u6301\u5009\u98a8\u96aa\u5206\u6790",
        "risk_limit_status": "\u98a8\u96aa\u9650\u5236\u72c0\u614b",
        "risk_alerts": "\u98a8\u96aa\u8b66\u5831\u65e5\u8a8c",
        "backtest": "\u7b56\u7565\u56de\u6e2c",
        "backtest_params": "\u56de\u6e2c\u53c3\u6578",
        "run_backtest": "\u57f7\u884c\u56de\u6e2c",
        "performance_summary": "\u7e3e\u6548\u6458\u8981",
        "equity_curve": "\u6b0a\u76ca\u66f2\u7dda",
        "trade_log": "\u4ea4\u6613\u65e5\u8a8c",
        "prev_backtests": "\u6b77\u53f2\u56de\u6e2c",
        "performance": "\u7e3e\u6548\u8ffd\u8e64",
        "signal_accuracy": "\u4fe1\u865f\u6e96\u78ba\u7387\u7d71\u8a08",
        "confidence_dist": "\u4fe1\u865f\u4fe1\u5fc3\u5ea6\u5206\u4f48",
        "signal_strength_time": "\u4fe1\u865f\u5f37\u5ea6\u8d8a\u52e2",
        "factor_contribution": "\u56e0\u5b50\u8ca2\u737b\u5206\u89e3",
        "backtest_comparison": "\u56de\u6e2c\u7e3e\u6548\u6bd4\u8f03",
        "transaction_summary": "\u4ea4\u6613\u6458\u8981",
        "settings": "\u7cfb\u7d71\u8a2d\u5b9a",
        "api_keys": "API \u91d1\u9470",
        "notifications": "\u901a\u77e5\u8a2d\u5b9a",
        "signal_weights": "\u4fe1\u865f\u6b0a\u91cd",
        "risk_parameters": "\u98a8\u63a7\u53c3\u6578",
        "data_management": "\u8cc7\u6599\u7ba1\u7406",
        "scheduler": "\u81ea\u52d5\u6392\u7a0b",
        "language": "\u8a9e\u8a00",
        "loading": "\u8f09\u5165\u4e2d",
        "no_data": "\u7121\u53ef\u7528\u8cc7\u6599",
        "computing": "\u8a08\u7b97\u4e2d",
        "fetching": "正在獲取市場行情...",
        "signal_summary": "信號摘要",
        "why_this_signal": "為什麼是這個信號？",
        "action_plan": "操作計劃",
        "shares_to_buy": "建議買入數量",
        "entry_price": "入場價格",
        "stop_loss_price": "止損價格",
        "position_size": "倉位大小",
        "dollar_risk": "風險金額",
        "target_price": "目標價格",
        "risk_reward": "風險回報比",
        "trade_blocked": "交易被阻擋",
        "of_portfolio": "佔投資組合",
        "below_entry": "低於入場價",
        "factors_agree": "所有因子方向一致——可靠度較高",
        "factors_disagree": "因子之間存在分歧——信心度已下調",
        "tip_rsi": "RSI 衡量股票是否超買或超賣。低於 30 = 超賣（潛在買入機會），高於 70 = 超買（潛在賣出信號）。",
        "tip_macd": "MACD 追蹤動能。當 MACD 上穿信號線時，暗示看漲動能。",
        "tip_bollinger": "布林通道顯示波動性。價格靠近下軌可能表示被低估。",
        "tip_sentiment": "情緒分析掃描新聞和社群媒體，判斷市場情緒——樂觀（看漲）或悲觀（看跌）。",
        "tip_ml": "機器學習模型（XGBoost、LightGBM、LSTM）利用歷史模式預測 5 日價格方向。",
        "tip_technical": "技術分析透過檢視價格模式和指標，根據歷史數據預測未來走勢。",
    },
}


def get_lang() -> str:
    """Get current language from session state."""
    return st.session_state.get("lang", "en")


def t(key: str) -> str:
    """Translate a key to the current language."""
    lang = get_lang()
    return TRANSLATIONS.get(lang, TRANSLATIONS["en"]).get(key, key)


def language_selector():
    """Render a language selector in the sidebar."""
    lang_options = {"en": "English", "zh": "\u4e2d\u6587"}
    current = get_lang()
    selected = st.sidebar.selectbox(
        "\U0001f310 Language",
        options=list(lang_options.keys()),
        format_func=lambda x: lang_options[x],
        index=list(lang_options.keys()).index(current),
        key="lang_selector",
    )
    if selected != current:
        st.session_state["lang"] = selected
        st.rerun()
